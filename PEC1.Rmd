---
title: "Informe PEC1"
author: "Irati Bastero"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##  Tabla de contenidos

## Abstract

## Objetivos del estudio. Debe de quedar bien claro cuáles son los objetivos de vuestro trabajo. Breves, media página a lo sumo.


## Materiales y Métodos

Con qué y cómo habéis trabajado. Variará según el caso, pero habitualmente contendrá: Origen (fuente) y naturaleza (tipo) de los datos; herramientas informáticas y bioinformáticas utilizadas. procedimiento general de análisis; métodos utilizados; Una o dos páginas como mucho.



## Resultados


```{r, include=FALSE}
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("SummarizedExperiment")
```
```{r}
library(SummarizedExperiment)
```


En primer lugar, voy a acceder al archivo xlsx
```{r}
library(readxl)

file <- "GastricCancer_NMR.xlsx"
```

```{r}
# Cargar datos de la hoja "Data"
data <- read_excel(file, sheet = "Data", na = "NA")

# Extraer las columnas de `colData` 
colData <- data[, c("SampleID", "SampleType", "Class")]

# Convertir `colData` a `data.frame`
colData <- DataFrame(colData)

# Usar `SampleID` como nombres de fila
rownames(colData) <- colData$SampleID

head(colData)
```

```{r}
# Crear la matriz de datos cuantitativos, seleccionando solo las columnas `M5` a `M149` de la hoja "Data"
data_matrix_counts <- data[, 5:ncol(data)]

# Convertir a matriz para asignar nombres de fila
data_matrix_counts <- as.matrix(data_matrix_counts)

# Asignar nombres de fila
rownames(data_matrix_counts) <- data$SampleID  

head(data_matrix_counts)
```

```{r}
# Cargar datos de la hoja "Peak"
row_metadata <- read_excel(file, sheet = "Peak", na = "NA")

# Asignar nombres de fila en `rowData` y convertir a `DataFrame`
rowData <- DataFrame(row_metadata)
rownames(rowData) <- row_metadata$Name  
head(rowData)
```

```{r}
# Nos aseguramos de que el número de filas de data_matrix_counts coincide con el número de filas de colData para evitar desajustes de dimensión.
dim(data_matrix_counts)  # should return (n_samples, n_features)
dim(colData)     # should return (n_samples, n_metadata)
dim(rowData)
```

```{r}
#Transponerla matriz de datos para que data_matrix_counts tenga las muestras como columnas y las características como filas
data_matrix_counts <- t(data_matrix_counts)
```


```{r}
# Comprobamos las dimensiones de nuevo
dim(data_matrix_counts)  # Should now return (n_features, n_samples)
dim(colData)             # Should return (n_samples, n_metadata)
```

```{r}
library(SummarizedExperiment)

# Crear el objeto SummarizedExperiment
se <- SummarizedExperiment(assays = list(counts = data_matrix_counts), rowData = rowData, colData = colData)

# Comprobamos la estructura de SummarizedExperiment
se
```

```{r}
class(se)
```

```{r}
assays(se)$counts
```

```{r}
assay_data <- assay(se)
summary(assay_data)
```

Recuento de valores perdidos:
```{r}
sum(is.na(assay_data))
```
```{r}
class(assay_data)
```

```{r}
colnames(assay_data)
rownames(assay_data)
```

Exploramos **rowData** para comprender los metadatos de cada característica
```{r}
rowData(se)
```
```{r}
summary(rowData(se))
```
Hacemos un recuento de valores perdidos:
```{r}
sum(is.na(rowData(se)$Perc_missing))
```

Exploramos **`colData`** para comprender los metadatos a nivel de muestra.
```{r}
colData(se)
```
```{r}
summary(colData(se))
```
Miramos qué tipo de muestras encontramos en el dataset:
```{r}
table(colData(se)$SampleType)
```
Observamos la distribución de las clases:
```{r}
table(colData(se)$Class)
```

Exploramos el objeto `metadata` y observamos que está vacío:
```{r}
metadata(se)
```
```{r}
# Creamos una lista 'metadata'
study_metadata <- list(
  description = "Dataset used in the CIMBC tutorial on Basic Metabolomics Data Analysis Workflow",
  citation = "Chan et al. (2016), British Journal of Cancer",
  project_id = "PR000699",
  doi = "10.21228/M8B10B",
  equipment = "1H-NMR spectra were acquired at Canada’s National High Field Nuclear Magnetic Resonance Centre (NANUC) using a 600 MHz Varian Inova spectrometer.",
  software = "Spectral deconvolution and metabolite annotation was performed using the Chenomx NMR Suite v7.6.",
  note = "Unfortunately, the Raw NMR data is unavailable."
)

metadata(se) <- study_metadata
```


```{r}
# Visualizamos la estructura y el contenido de 'metadata'
str(se)
metadata(se)
```





## Discusión y limitaciones y conclusiones del estudio







